<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0abab5">
  <title>Pomodoro Timer</title>
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUG9tb2Rvcm8gVGltZXIiLCJzaG9ydF9uYW1lIjoiUG9tb2Rvcm8iLCJkZXNjcmlwdGlvbiI6IuODh+OCueOCr+ODiOODg+ODl+S9nOalreS4reOBrumbhuS4reOCv+OCpOODnuODvCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjlmYWZiIiwidGhlbWVfY29sb3IiOiIjMGFiYWI1IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjxjaXJjbGUgY3g9JzUwJyBjeT0nNTAnIHI9JzQ1JyBmaWxsPScjMGFiYWI1Jy8+PC9zdmc+Iiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useEffect, useRef } = React;

    // Lucide Icons as React components
    const Play = ({ size = 24, className = "" }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round",
        className: className
      },
        React.createElement('polygon', { points: "5 3 19 12 5 21 5 3" })
      )
    );

    const Pause = ({ size = 24 }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round"
      },
        React.createElement('rect', { x: "6", y: "4", width: "4", height: "16" }),
        React.createElement('rect', { x: "14", y: "4", width: "4", height: "16" })
      )
    );

    const RotateCcw = ({ size = 24 }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round"
      },
        React.createElement('polyline', { points: "1 4 1 10 7 10" }),
        React.createElement('path', { d: "M3.51 15a9 9 0 1 0 2.13-9.36L1 10" })
      )
    );

    const Settings = ({ size = 24, className = "" }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round",
        className: className
      },
        React.createElement('path', { d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" }),
        React.createElement('circle', { cx: "12", cy: "12", r: "3" })
      )
    );

    const BarChart3 = ({ size = 24, className = "" }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round",
        className: className
      },
        React.createElement('path', { d: "M3 3v18h18" }),
        React.createElement('path', { d: "M18 17V9" }),
        React.createElement('path', { d: "M13 17V5" }),
        React.createElement('path', { d: "M8 17v-3" })
      )
    );

    const X = ({ size = 24, className = "" }) => (
      React.createElement('svg', {
        xmlns: "http://www.w3.org/2000/svg",
        width: size,
        height: size,
        viewBox: "0 0 24 24",
        fill: "none",
        stroke: "currentColor",
        strokeWidth: "2",
        strokeLinecap: "round",
        strokeLinejoin: "round",
        className: className
      },
        React.createElement('line', { x1: "18", y1: "6", x2: "6", y2: "18" }),
        React.createElement('line', { x1: "6", y1: "6", x2: "18", y2: "18" })
      )
    );

    // Storage implementation
    const storage = {
      async get(key) {
        try {
          const value = localStorage.getItem(key);
          return value ? { key, value } : null;
        } catch (error) {
          console.error('Storage get error:', error);
          return null;
        }
      },
      async set(key, value) {
        try {
          localStorage.setItem(key, value);
          return { key, value };
        } catch (error) {
          console.error('Storage set error:', error);
          return null;
        }
      }
    };

    window.storage = storage;

    const PomodoroTimer = () => {
      const [workTime, setWorkTime] = useState(25);
      const [breakTime, setBreakTime] = useState(5);
      const [timeLeft, setTimeLeft] = useState(25 * 60);
      const [isRunning, setIsRunning] = useState(false);
      const [isWorkMode, setIsWorkMode] = useState(true);
      const [sessions, setSessions] = useState([]);
      const [customMessage, setCustomMessage] = useState('立ち上がって遠くを見ながら、軽くストレッチしましょう');
      const [showSettings, setShowSettings] = useState(false);
      const [showStats, setShowStats] = useState(false);
      const [currentWeekOffset, setCurrentWeekOffset] = useState(0);
      const audioRef = useRef(null);

      useEffect(() => {
        const loadData = async () => {
          try {
            const sessionsResult = await window.storage.get('pomodoro-sessions');
            if (sessionsResult && sessionsResult.value) {
              setSessions(JSON.parse(sessionsResult.value));
            }

            const settingsResult = await window.storage.get('pomodoro-settings');
            if (settingsResult && settingsResult.value) {
              const settings = JSON.parse(settingsResult.value);
              setWorkTime(settings.workTime || 25);
              setBreakTime(settings.breakTime || 5);
              setCustomMessage(settings.customMessage || '立ち上がって遠くを見ながら、軽くストレッチしましょう');
              setTimeLeft((settings.workTime || 25) * 60);
            }
          } catch (error) {
            console.log('データの読み込みに失敗しました');
          }
        };
        loadData();
      }, []);

      const saveSettings = async () => {
        const settings = { workTime, breakTime, customMessage };
        try {
          await window.storage.set('pomodoro-settings', JSON.stringify(settings));
        } catch (error) {
          console.error('設定の保存に失敗しました');
        }
      };

      useEffect(() => {
        let interval = null;
        if (isRunning && timeLeft > 0) {
          interval = setInterval(() => {
            setTimeLeft(time => time - 1);
          }, 1000);
        } else if (timeLeft === 0 && isRunning) {
          setIsRunning(false);
          if (audioRef.current) {
            audioRef.current.play();
          }
          
          if (isWorkMode) {
            completeSession();
            if (breakTime > 0) {
              setIsWorkMode(false);
              setTimeLeft(breakTime * 60);
            } else {
              setTimeLeft(workTime * 60);
            }
          } else {
            setIsWorkMode(true);
            setTimeLeft(workTime * 60);
          }
        }
        return () => clearInterval(interval);
      }, [isRunning, timeLeft, isWorkMode, workTime, breakTime]);

      const completeSession = async () => {
        const newSession = {
          date: new Date().toISOString(),
          duration: workTime * 60
        };
        const updatedSessions = [...sessions, newSession];
        setSessions(updatedSessions);
        
        try {
          await window.storage.set('pomodoro-sessions', JSON.stringify(updatedSessions));
        } catch (error) {
          console.error('セッションの保存に失敗しました');
        }
      };

      const toggleTimer = () => {
        setIsRunning(!isRunning);
      };

      const resetTimer = () => {
        setIsRunning(false);
        setIsWorkMode(true);
        setTimeLeft(workTime * 60);
      };

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      };

      const getTodaySessions = () => {
        const today = new Date().toDateString();
        return sessions.filter(s => new Date(s.date).toDateString() === today).length;
      };

      const getWeekSessions = () => {
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        return sessions.filter(s => new Date(s.date) >= weekAgo).length;
      };

      const getCurrentDayOfWeek = () => {
        return new Date().getDay() === 0 ? 7 : new Date().getDay();
      };

      const applySettings = () => {
        saveSettings();
        setTimeLeft(workTime * 60);
        setIsWorkMode(true);
        setIsRunning(false);
        setShowSettings(false);
      };

      const getWeekData = (weekOffset) => {
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay() + 1 - (weekOffset * 7));
        
        const weekData = [];
        const days = ['月', '火', '水', '木', '金', '土', '日'];
        
        for (let i = 0; i < 7; i++) {
          const currentDay = new Date(startOfWeek);
          currentDay.setDate(startOfWeek.getDate() + i);
          const dayString = currentDay.toDateString();
          const count = sessions.filter(s => new Date(s.date).toDateString() === dayString).length;
          
          weekData.push({
            day: days[i],
            date: currentDay,
            count: count
          });
        }
        
        return weekData;
      };

      const weekData = getWeekData(currentWeekOffset);
      const maxCount = Math.max(...weekData.map(d => d.count), 1);

      const getWeekDateRange = () => {
        const startDate = weekData[0].date;
        const endDate = weekData[6].date;
        return `${startDate.getMonth() + 1}/${startDate.getDate()} - ${endDate.getMonth() + 1}/${endDate.getDate()}`;
      };

      return React.createElement('div', { className: "min-h-screen bg-gray-50 flex items-center justify-center p-4" },
        React.createElement('div', { className: "w-full max-w-md" },
          React.createElement('div', { className: "bg-white rounded-2xl shadow-sm p-8" },
            React.createElement('div', { className: "flex justify-between items-center mb-8" },
              React.createElement('h1', { className: "text-2xl font-bold text-gray-800" }, 'Pomodoro'),
              React.createElement('div', { className: "flex gap-2" },
                React.createElement('button', {
                  onClick: () => setShowStats(!showStats),
                  className: "p-2 rounded-lg hover:bg-gray-100 transition-colors"
                }, React.createElement(BarChart3, { size: 20, className: "text-gray-600" })),
                React.createElement('button', {
                  onClick: () => setShowSettings(!showSettings),
                  className: "p-2 rounded-lg hover:bg-gray-100 transition-colors"
                }, React.createElement(Settings, { size: 20, className: "text-gray-600" }))
              )
            ),

            showSettings && React.createElement('div', { className: "mb-6 p-4 bg-gray-50 rounded-lg" },
              React.createElement('div', { className: "flex justify-between items-center mb-4" },
                React.createElement('h3', { className: "font-semibold text-gray-700" }, '設定'),
                React.createElement('button', { onClick: () => setShowSettings(false) },
                  React.createElement(X, { size: 18, className: "text-gray-500" })
                )
              ),
              React.createElement('div', { className: "space-y-4" },
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm text-gray-600 mb-1" }, '作業時間（分）'),
                  React.createElement('input', {
                    type: "number",
                    value: workTime,
                    onChange: (e) => setWorkTime(Math.max(1, parseInt(e.target.value) || 1)),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm text-gray-600 mb-1" }, '休憩時間（分、0で無効）'),
                  React.createElement('input', {
                    type: "number",
                    value: breakTime,
                    onChange: (e) => setBreakTime(Math.max(0, parseInt(e.target.value) || 0)),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm text-gray-600 mb-1" }, 'カスタムメッセージ'),
                  React.createElement('input', {
                    type: "text",
                    value: customMessage,
                    onChange: (e) => setCustomMessage(e.target.value),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"
                  })
                ),
                React.createElement('button', {
                  onClick: applySettings,
                  className: "w-full py-2 rounded-lg text-white font-medium",
                  style: { backgroundColor: '#0abab5' }
                }, '設定を適用')
              )
            ),

            showStats && React.createElement('div', { className: "mb-6 p-4 bg-gray-50 rounded-lg" },
              React.createElement('div', { className: "flex justify-between items-center mb-4" },
                React.createElement('h3', { className: "font-semibold text-gray-700" }, '週間統計'),
                React.createElement('button', { onClick: () => setShowStats(false) },
                  React.createElement(X, { size: 18, className: "text-gray-500" })
                )
              ),
              React.createElement('div', { className: "text-center text-sm text-gray-600 mb-4" }, getWeekDateRange()),
              React.createElement('div', { className: "flex justify-between items-end h-32 mb-4" },
                weekData.map((data, index) =>
                  React.createElement('div', { key: index, className: "flex flex-col items-center flex-1" },
                    React.createElement('div', { className: "w-full flex items-end justify-center", style: { height: '100px' } },
                      React.createElement('div', {
                        className: "w-8 rounded-t transition-all",
                        style: {
                          height: `${(data.count / maxCount) * 100}%`,
                          backgroundColor: '#0abab5',
                          minHeight: data.count > 0 ? '8px' : '0'
                        }
                      })
                    ),
                    React.createElement('div', { className: "text-xs text-gray-600 mt-2" }, data.day),
                    React.createElement('div', { className: "text-xs text-gray-400" }, data.count)
                  )
                )
              ),
              React.createElement('div', { className: "flex gap-2" },
                React.createElement('button', {
                  onClick: () => setCurrentWeekOffset(currentWeekOffset + 1),
                  className: "flex-1 py-2 px-4 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50"
                }, '← 前の週'),
                React.createElement('button', {
                  onClick: () => setCurrentWeekOffset(Math.max(0, currentWeekOffset - 1)),
                  disabled: currentWeekOffset === 0,
                  className: "flex-1 py-2 px-4 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                }, '次の週 →')
              )
            ),

            React.createElement('div', { className: "text-center mb-8" },
              React.createElement('div', { className: "text-7xl font-light text-gray-800 tracking-tight" },
                formatTime(timeLeft)
              )
            ),

            React.createElement('div', { className: "flex gap-4 justify-center mb-6" },
              React.createElement('button', {
                onClick: toggleTimer,
                className: "w-16 h-16 rounded-full text-white flex items-center justify-center transition-colors shadow-md",
                style: { backgroundColor: '#0abab5' },
                onMouseEnter: (e) => e.currentTarget.style.backgroundColor = '#099d99',
                onMouseLeave: (e) => e.currentTarget.style.backgroundColor = '#0abab5'
              }, isRunning ? React.createElement(Pause, { size: 24 }) : React.createElement(Play, { size: 24, className: "ml-1" })),
              React.createElement('button', {
                onClick: resetTimer,
                className: "w-16 h-16 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700 flex items-center justify-center transition-colors"
              }, React.createElement(RotateCcw, { size: 24 }))
            ),

            React.createElement('div', { className: "pt-2" },
              React.createElement('div', { className: "grid grid-cols-2 gap-4 text-center" },
                React.createElement('div', null,
                  React.createElement('div', { className: "text-3xl font-light text-gray-800" }, getTodaySessions()),
                  React.createElement('div', { className: "text-sm text-gray-500 mt-1" }, '今日')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: "text-3xl font-light text-gray-800" }, getWeekSessions()),
                  React.createElement('div', { className: "text-sm text-gray-500 mt-1" }, '今週'),
                  React.createElement('div', { className: "text-xs text-gray-400 mt-0.5" }, `${getCurrentDayOfWeek()}/7`)
                )
              )
            )
          ),

          React.createElement('div', { className: "text-center mt-6 text-sm text-gray-500" }, customMessage)
        ),

        React.createElement('audio', {
          ref: audioRef,
          src: "data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZUQ0PV6vo7aZaEgpDm9/wuHQeBi+A0PPWiy8GJXrI8NuXQgoSYLPp7qhWFAw9mNvvvncjBCt90e/WizYGJHPC8NyUOwkRXK7n7KdUEg1Cnd/yuHUgBTGJ0vTWiyMGJXnI8NuWPwoUY7Xp7qZYFg5AmNvvwH0dBi110O/VizAGJ3TC8NyTOwkTXa3o7KhWEw1Am9/xu3UgBjGI0vTWiyIGJ3jH8NuWPgoUZLXp7qRYFg5BmNvwwH0dBix10O/UjC8GKHbB8NyTOwkTXa3o7KdVEw1Bmd/xu3QgBjGI0fPWiyIGKHjH8NuWPQoUZLPp7qRYFg5BmdvwwX0dBix10O/UjC8GKHbB8NySOwkTXKzn66dVEw1Cmd/xu3UfBjGI0fPWiyIGKHjH8NuWPQoUY7Pp7qNYFg5BmdrwwXwdBixy0O/UjS8GKHXB8NySOwkSW6zn66dWFA1Cmd/yu3YgBjCH0fPWih8GKHjH8NuVPgoTY7Tp7aRXFg5AmNrwwn0dBSty0O/UjS8GJ3TB8NySOwoSW6vn66ZWEw1Cmd/yu3YgBjCH0PPWih8GKHjH8NuWPQoTY7Tp7aRXFQ5BmNrwwn0dBitx0O/TjS8GJ3TB8NyROwoSXKvn66ZWEw1Cmd/yu3YfBjCH0PPWih8GKHjH8NuWPgoTY7Tp7aRXFQ5BmNrwwn0dBitx0O/TjS4GKHXC8N2ROwkSXKvn66ZWEw1Gud/yu3YfBjCH0PPWih4GKXXH8N2WPgoTYrPp7aJWFQ5BmNrwwn0dBitx0O/TjS4GKHbC8N2ROwkRW6vn66ZVEw1Gud/zu3YfBjCH0PPWih4GKXbH8N2WPgoTYrPp7aJWFQ5BmNrwwX0dBitx0O/TjS4GKHbC8N2QOwkRW6vn66ZVEw1Gud/zu3YfBi+H0PPWih4GKXbH8N2WPQoTYrPp7aJWFQ5BmNrwwX0dBitx0O/TjC4GKHbC8N2QOwkRW6vn66ZVEgxCmd/zu3YfBi+H0fPWih4GKXbH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitx0O/TjC4GKHbC8N2QOwkRW6vn66ZVEgxCmd/zu3YfBi+G0fPWih4GKXbH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkSXKvm66dVEgxCmd/zu3YfBi+G0fPWih4GKXbH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkSXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPgoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQoTYrTp7aJWFQ5BmNrwwX0dBitw0O/SjC4FKHXB8N2QOwkRXKvm66dVEgxCmd/zu3YfBi+G0fPVih4GKXXH8N2WPQo="
        })
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(PomodoroTimer));

    // Service Worker registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        const swCode = `
          const CACHE_NAME = 'pomodoro-v1';
          self.addEventListener('install', (event) => {
            event.waitUntil(self.skipWaiting());
          });
          self.addEventListener('activate', (event) => {
            event.waitUntil(self.clients.claim());
          });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed'));
      });
    }

    // Install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      const installBanner = document.createElement('div');
      installBanner.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #0abab5; color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; cursor: pointer;';
      installBanner.textContent = 'アプリとしてインストール';
      installBanner.onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          deferredPrompt = null;
          installBanner.remove();
        });
      };
      document.body.appendChild(installBanner);
    });
  </script>
</body>
</html>